"use strict";$(".direct-chat-messages,.direct-chat-contacts").height($(window).height()-300),$.warning=function(t){var n=$(warningPanel);n.find(".warning-content").html(t),n.show().fadeOut(2500),$('input[data-ng-model="viewData.sendContent"]').focus()};
"use strict";angular.module("chatApp",[]).factory("nameGenerator",function(){var e=["伯毅","节都","另林","逐天","逐日","昊祯","昊天","龙恩","炎恩","鸿恩","希文","希诚","玄华","玄晋","元贞","伸义","巴莫","子烨","子龙","子赫","圣卿","尚儒","水哲","祺祾","祾祯","焜煊","施祁","善琦","垚丞","兴尧","可尧","炫琰","家宇","子骞","峻熙","嘉懿","煜城","懿轩","烨华","煜祺","智宸","正豪","昊然","志泽","明杰","弘文","烨伟","苑博","鹏涛","炎彬","鹤轩","伟泽","君昊","熠彤","鸿煊","博涛","苑杰","黎昕","烨霖","哲瀚","雨泽","楷瑞","建辉","致远","俊驰","雨泽","烨磊","国豪","伟奇","文博","天佑","文昊","修杰","黎昕","远航","旭尧","英杰","圣杰","俊楠","鸿涛","伟祺","荣轩","浩宇","晋鹏","静香","梦洁","凌薇","美莲","雅静","雪丽","依娜","雅芙","雨婷","晟涵","梦舒","秀影","海琼","雪娴","梦梵","笑薇","瑾梅","晟楠","歆婷","思颖","欣然","可岚","天瑜","婧琪","媛馨","玥婷","滢心","雪馨","姝瑗","颖娟","歆瑶","凌菲","钰琪","婧宸","靖瑶","瑾萱","佑怡","婳祎","檀雅","若翾","熙雯","语嫣","妍洋","滢玮","沐卉","琪涵","佳琦","伶韵","思睿","清菡","欣溶","菲絮","诗涵","璇滢","静馨","妙菱","心琪","雅媛","晨芙","婧诗","露雪","蕊琪","舒雅"];return function(){return e[Math.floor(Math.random()*e.length)]}}).controller("chatCtrl",["$scope","nameGenerator","$timeout",function(e,n,t){var o,i=600,a=io(),s=!1,r=!1,u=$('input[data-ng-model="viewData.sendContent"]'),c=function(){s&&(r||(r=!0,a.emit("typing")),o=(new Date).getTime(),setTimeout(function(){var e=(new Date).getTime(),n=e-o;n>=i&&r&&(a.emit("stop typing"),r=!1)},i))};e.keydownHandler=function(n){n.ctrlKey||n.metaKey||n.altKey||u.focus(),13===n.which&&e.sendMessage()},u.on("input",function(){c()}),a.on("login",function(n){s=!0,e.notify({content:"欢迎来到聊天室",icon:"fa-smile-o"}),e.viewData.numUsers=n.numUsers,e.$digest()}),a.on("new message",function(n){e.viewData.chatQueue.push(n),t(function(){$(".direct-chat-messages").scrollTop(99999)},1),e.$digest()}),a.on("user joined",function(n){e.notify({content:n.user.name+"来打酱油了...",icon:"fa-user-plus"}),e.viewData.numUsers=n.numUsers,e.$digest()}),a.on("user left",function(n){e.notify({content:n.user.name+"妈妈喊他回家吃饭了...",icon:"fa-hand-peace-o"}),e.viewData.numUsers=n.numUsers,e.$digest()}),a.on("typing",function(n){e.addChatTyping(n),e.$digest()}),a.on("stop typing",function(n){e.removeChatTyping(n),e.$digest()}),e.chatroom={name:"食堂开门了,冲!"},e.currentUser=__currentUser,e.viewData={messages:[],notifications:[],chatQueue:[],logInfo:[],contactQueue:[],sendContent:"",numUsers:1},e.log=function(n){e.viewData.logInfo.unshift(n)},e.removeLog=function(n){for(var t=0;t<e.viewData.logInfo.length&&e.viewData.logInfo[t]._id!==n;)t++;t>-1&&e.viewData.logInfo.splice(t,1)},e.notify=function(n){e.viewData.notifications.unshift(n)},e.sendMessage=function(){if(a.emit("stop typing"),r=!1,""!=e.viewData.sendContent){var n={message:e.viewData.sendContent};a.emit("new message",n),n.isMine=!0,n.sender=e.currentUser,n.createTime=new Date,e.viewData.chatQueue.push(n),e.viewData.sendContent="",u.blur(),t(function(){$(".direct-chat-messages").scrollTop(99999)},1)}else $.warning("发送内容不能为空!")},e.addChatTyping=function(n){e.log({_id:n._id,content:n.user.name+"正在输入..."})},e.removeChatTyping=function(n){e.removeLog(n._id)},a.emit("add user",e.currentUser)}]);